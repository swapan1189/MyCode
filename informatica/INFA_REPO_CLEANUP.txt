NOTE: Please take the Repository backup file and then disable the repository service before executing the steps below:

---Full backup

ALTER SESSION SET CURRENT_SCHEMA=REP_EDP_BIDW_PROD

create  TABLE OPB_SESS_TASK_LOG_bk_0830 as SELECT * FROM OPB_SESS_TASK_LOG;
create  TABLE OPB_SWIDGINST_LOG_bk_0830 as SELECT * FROM OPB_SWIDGINST_LOG;
create  TABLE OPB_DTL_SWIDG_LOG_bk_0830 as SELECT * FROM OPB_DTL_SWIDG_LOG;
create  TABLE OPB_TASK_INST_RUN_bk_0830 as SELECT * FROM OPB_TASK_INST_RUN;
create  TABLE OPB_WFLOW_VAR_RUN_bk_0830 as SELECT * FROM OPB_WFLOW_VAR_RUN;
create  TABLE OPB_WFLOW_DEP_RUN_bk_0830 as SELECT * FROM OPB_WFLOW_DEP_RUN;
create  TABLE OPB_WFLOW_CACHE_bk_0830 as SELECT * FROM OPB_WFLOW_CACHE;
create  TABLE OPB_WFLOW_RUN_BRK_bk_0830 as SELECT * FROM OPB_WFLOW_RUN_BRK;
create  TABLE OPB_TASK_INST_BRK_bk_0830 as SELECT * FROM OPB_TASK_INST_BRK;
create  TABLE OPB_PERF_COUNT_bk_0830 as SELECT * FROM OPB_PERF_COUNT;
create  TABLE OPB_WFLOW_RUN_bk_0830 as SELECT * FROM OPB_WFLOW_RUN;


--Provide read only access to user REP_BIDW_PROD_RONLY for above bk_0830 tables.

--- Temporary 40 days backup



CREATE TABLE OPB_SESS_TASK_LOG_bk1_0830 AS 
SELECT A.* FROM OPB_SESS_TASK_LOG A,OPB_WFLOW_RUN B 
WHERE A.WORKFLOW_RUN_ID=B.WORKFLOW_RUN_ID AND
B.END_TIME >= SYSDATE-40 AND B.END_TIME IS NOT NULL;

CREATE TABLE OPB_SWIDGINST_LOG_bk1_0830 AS 
SELECT A.* FROM OPB_SWIDGINST_LOG A,OPB_WFLOW_RUN B 
WHERE A.WORKFLOW_RUN_ID=B.WORKFLOW_RUN_ID AND
B.END_TIME >= SYSDATE-40 AND B.END_TIME IS NOT NULL;

CREATE TABLE OPB_DTL_SWIDG_LOG_bk1_0830 AS 
SELECT A.* FROM OPB_DTL_SWIDG_LOG A,OPB_WFLOW_RUN B 
WHERE A.WORKFLOW_RUN_ID=B.WORKFLOW_RUN_ID AND
B.END_TIME >= SYSDATE-40 AND B.END_TIME IS NOT NULL;

CREATE TABLE OPB_TASK_INST_RUN_bk1_0830 AS 
SELECT A.* FROM OPB_TASK_INST_RUN A,OPB_WFLOW_RUN B 
WHERE A.WORKFLOW_RUN_ID=B.WORKFLOW_RUN_ID AND
B.END_TIME >= SYSDATE-40 AND B.END_TIME IS NOT NULL;

CREATE TABLE OPB_WFLOW_VAR_RUN_bk1_0830 AS 
SELECT A.* FROM OPB_WFLOW_VAR_RUN A,OPB_WFLOW_RUN B 
WHERE A.WORKFLOW_RUN_ID=B.WORKFLOW_RUN_ID AND
B.END_TIME >= SYSDATE-40 AND B.END_TIME IS NOT NULL;

CREATE TABLE OPB_WFLOW_DEP_RUN_bk1_0830 AS 
SELECT A.* FROM OPB_WFLOW_DEP_RUN A,OPB_WFLOW_RUN B 
WHERE A.WORKFLOW_RUN_ID=B.WORKFLOW_RUN_ID AND
B.END_TIME >= SYSDATE-40 AND B.END_TIME IS NOT NULL;

CREATE TABLE OPB_WFLOW_CACHE_bk1_0830 AS 
SELECT A.* FROM OPB_WFLOW_CACHE A,OPB_WFLOW_RUN B 
WHERE A.WORKFLOW_RUN_ID=B.WORKFLOW_RUN_ID AND
B.END_TIME >= SYSDATE-40 AND B.END_TIME IS NOT NULL;

CREATE TABLE OPB_WFLOW_RUN_BRK_bk1_0830 AS SELECT A.* FROM OPB_WFLOW_RUN_BRK A,OPB_WFLOW_RUN B 
WHERE A.WORKFLOW_RUN_ID=B.WORKFLOW_RUN_ID AND B.END_TIME >= SYSDATE-40 AND B.END_TIME IS NOT NULL;

CREATE TABLE OPB_TASK_INST_BRK_bk1_0830 AS SELECT A.* FROM OPB_TASK_INST_BRK A,OPB_WFLOW_RUN B 
WHERE A.WORKFLOW_RUN_ID=B.WORKFLOW_RUN_ID AND B.END_TIME >= SYSDATE-40 AND B.END_TIME IS NOT NULL;


CREATE TABLE OPB_PERF_COUNT_bk1_0830 AS SELECT A.* FROM OPB_PERF_COUNT A,OPB_WFLOW_RUN B 
WHERE A.WORKFLOW_RUN_ID=B.WORKFLOW_RUN_ID AND B.END_TIME >= SYSDATE-40 AND B.END_TIME IS NOT NULL;


CREATE TABLE OPB_WFLOW_RUN_bk1_0830 AS SELECT * FROM OPB_WFLOW_RUN 
WHERE END_TIME >= SYSDATE-40 AND END_TIME IS NOT NULL;



--Truncate main Tables

TRUNCATE TABLE OPB_SESS_TASK_LOG;
TRUNCATE TABLE OPB_SWIDGINST_LOG;
TRUNCATE TABLE OPB_DTL_SWIDG_LOG;
TRUNCATE TABLE OPB_TASK_INST_RUN;
TRUNCATE TABLE OPB_WFLOW_VAR_RUN;
TRUNCATE TABLE OPB_WFLOW_DEP_RUN;
TRUNCATE TABLE OPB_WFLOW_CACHE;
TRUNCATE TABLE OPB_WFLOW_RUN_BRK;
TRUNCATE TABLE OPB_TASK_INST_BRK;
TRUNCATE TABLE OPB_PERF_COUNT;
TRUNCATE TABLE OPB_WFLOW_RUN;


---insert from the temp bk1_0830 tables

INSERT INTO OPB_SESS_TASK_LOG SELECT * FROM OPB_SESS_TASK_LOG_bk1_0830;
COMMIT;

INSERT INTO OPB_SWIDGINST_LOG  SELECT * FROM OPB_SWIDGINST_LOG_bk1_0830;
COMMIT;

INSERT INTO OPB_DTL_SWIDG_LOG SELECT * FROM OPB_DTL_SWIDG_LOG_bk1_0830;
COMMIT;

INSERT INTO OPB_TASK_INST_RUN SELECT * FROM OPB_TASK_INST_RUN_bk1_0830;
COMMIT;

INSERT INTO OPB_WFLOW_VAR_RUN SELECT * FROM OPB_WFLOW_VAR_RUN_bk1_0830;
COMMIT;

INSERT INTO OPB_WFLOW_DEP_RUN SELECT * FROM OPB_WFLOW_DEP_RUN_bk1_0830; 
COMMIT;

INSERT INTO OPB_WFLOW_CACHE SELECT * FROM OPB_WFLOW_CACHE_bk1_0830;
COMMIT;

INSERT INTO OPB_WFLOW_RUN_BRK SELECT * FROM OPB_WFLOW_CACHE_bk1_0830;
COMMIT;

INSERT INTO OPB_TASK_INST_BRK SELECT * FROM OPB_WFLOW_CACHE_bk1_0830;
COMMIT;

INSERT INTO OPB_PERF_COUNT SELECT * FROM OPB_WFLOW_CACHE_bk1_0830;
COMMIT;

INSERT INTO OPB_WFLOW_RUN SELECT * FROM OPB_WFLOW_RUN_bk1_0830; 
COMMIT;

ANALYZE TABLE OPB_DTL_SWIDG_LOG COMPUTE STATISTICS;
ANALYZE TABLE OPB_SESS_TASK_LOG COMPUTE STATISTICS;
ANALYZE TABLE OPB_SWIDGINST_LOG COMPUTE STATISTICS;
ANALYZE TABLE OPB_TASK_INST_RUN COMPUTE STATISTICS;
ANALYZE TABLE OPB_WFLOW_CACHE COMPUTE STATISTICS;
ANALYZE TABLE OPB_WFLOW_DEP_RUN COMPUTE STATISTICS;
ANALYZE TABLE OPB_WFLOW_RUN_BRK COMPUTE STATISTICS;
ANALYZE TABLE OPB_TASK_INST_BRK COMPUTE STATISTICS;
ANALYZE TABLE OPB_PERF_COUNT COMPUTE STATISTICS;
ANALYZE TABLE OPB_WFLOW_RUN COMPUTE STATISTICS;
ANALYZE TABLE OPB_WFLOW_VAR_RUN COMPUTE STATISTICS;

ANALYZE INDEX OPB_DTLWIDLG_IDX COMPUTE STATISTICS;
ANALYZE INDEX OPB_STASKLG_IDX COMPUTE STATISTICS;
ANALYZE INDEX OPB_SWINSTLG_IDX COMPUTE STATISTICS;
ANALYZE INDEX OPB_TINSTLG_IDX COMPUTE STATISTICS;
ANALYZE INDEX OPB_TINSTLG_IDX2 COMPUTE STATISTICS;
ANALYZE INDEX OPB_WFCACHELG_IDX COMPUTE STATISTICS;
ANALYZE INDEX OPB_WFDEPLG_IDX COMPUTE STATISTICS;
ANALYZE INDEX OPB_WFDEPLG_IDX2 COMPUTE STATISTICS;
ANALYZE INDEX OPB_WFLG_IDX COMPUTE STATISTICS;
ANALYZE INDEX OPB_WFLG_IDX2 COMPUTE STATISTICS;
ANALYZE INDEX OPB_WFLG_IDX3 COMPUTE STATISTICS;
ANALYZE INDEX OPB_WFVARLG_IDX COMPUTE STATISTICS; 
ANALYZE INDEX OPB_TINSBRK_IDX COMPUTE STATISTICS; 
ANALYZE INDEX OPB_WFBRK_IDX COMPUTE STATISTICS; 
ANALYZE INDEX OPB_PF_COUNT_IDX COMPUTE STATISTICS; 
ANALYZE INDEX OPB_PF_COUNT_IDX2 COMPUTE STATISTICS; 

DROP TABLE OPB_SESS_TASK_LOG_bk1_0830;
DROP TABLE OPB_SWIDGINST_LOG_bk1_0830;
DROP TABLE OPB_DTL_SWIDG_LOG_bk1_0830;
DROP TABLE OPB_TASK_INST_RUN_bk1_0830;
DROP TABLE OPB_WFLOW_VAR_RUN_bk1_0830;
DROP TABLE OPB_WFLOW_DEP_RUN_bk1_0830;
DROP TABLE OPB_WFLOW_CACHE_bk1_0830;
DROP TABLE OPB_WFLOW_RUN_BRK_bk1_0830;
DROP TABLE OPB_TASK_INST_BRK_bk1_0830;
DROP TABLE OPB_PERF_COUNT_bk1_0830;
DROP TABLE OPB_WFLOW_RUN_bk1_0830;


COMMIT;


